import{c as le,a as o,s as i,f as p,d as Qe}from"../chunks/DrEVJf_X.js";import{o as Ve}from"../chunks/CY6dNTIf.js";import{a0 as oe,aa as R,a2 as de,a4 as t,a7 as a,a1 as f,a3 as n,g as e,a8 as Q,ab as We,b as F,av as Xe,a5 as Ye,an as B,ao as Ze}from"../chunks/BIQOLOFU.js";import{i as g}from"../chunks/NPzolRrf.js";import{e as ce,i as pe}from"../chunks/BPKzcg-U.js";import{h as ea}from"../chunks/82X_sTQh.js";import{s as V}from"../chunks/Bz7eZnhB.js";import{s as aa,a as ta}from"../chunks/jma30hyI.js";import{p as ra}from"../chunks/BON2bsc1.js";import{a as sa}from"../chunks/D6zz_Kj-.js";import{s as ke}from"../chunks/CDiOZD_h.js";import{s as na}from"../chunks/DrIL6A14.js";var va=p('<p class="empty svelte-1r2hed0"> </p>'),ia=p('<span class="rel-source svelte-1r2hed0"> </span> <span class="rel-type svelte-1r2hed0"> </span> <span class="arrow svelte-1r2hed0">&rarr;</span> <a class="rel-target svelte-1r2hed0"> </a> <span class="rel-entity-type svelte-1r2hed0"> </span>',1),la=p('<a class="rel-source svelte-1r2hed0"> </a> <span class="rel-entity-type svelte-1r2hed0"> </span> <span class="rel-type svelte-1r2hed0"> </span> <span class="arrow svelte-1r2hed0">&rarr;</span> <span class="rel-target svelte-1r2hed0"> </span>',1),oa=p('<li class="rel-item svelte-1r2hed0"><div class="rel-arrow svelte-1r2hed0"><!></div> <div class="rel-confidence svelte-1r2hed0"><div class="confidence-bar svelte-1r2hed0"><div class="confidence-fill svelte-1r2hed0"></div></div> <span class="confidence-value svelte-1r2hed0"> </span></div></li>'),da=p('<ul class="rel-list svelte-1r2hed0"></ul>');function ze(H,x){oe(x,!0);var S=le(),J=R(S);{var A=$=>{var m=va(),h=t(m);a(m),f(()=>i(h,`No ${x.direction??""} relationships.`)),o($,m)},s=$=>{var m=da();ce(m,21,()=>x.relationships,pe,(h,l)=>{var M=oa(),y=t(M),E=t(y);{var L=_=>{var r=ia(),v=R(r),k=t(v,!0);a(v);var z=n(v,2),D=t(z,!0);a(z);var b=n(z,4),G=t(b,!0);a(b);var u=n(b,2),N=t(u);a(u),f(()=>{i(k,x.entityName),i(D,e(l).relationship_type),ke(b,"href",`/knowledge-graph/${e(l).entity_id??""}`),i(G,e(l).entity_name),i(N,`(${e(l).entity_type??""})`)}),o(_,r)},C=_=>{var r=la(),v=R(r),k=t(v,!0);a(v);var z=n(v,2),D=t(z);a(z);var b=n(z,2),G=t(b,!0);a(b);var u=n(b,4),N=t(u,!0);a(u),f(()=>{ke(v,"href",`/knowledge-graph/${e(l).entity_id??""}`),i(k,e(l).entity_name),i(D,`(${e(l).entity_type??""})`),i(G,e(l).relationship_type),i(N,x.entityName)}),o(_,r)};g(E,_=>{x.direction==="outgoing"?_(L):_(C,!1)})}a(y);var O=n(y,2),I=t(O),P=t(I);a(I);var j=n(I,2),T=t(j);a(j),a(O),a(M),f((_,r)=>{V(P,`width: ${_??""}%`),i(T,`${r??""}%`)},[()=>Math.round(e(l).confidence_score*100),()=>Math.round(e(l).confidence_score*100)]),o(h,M)}),a(m),o($,m)};g(J,$=>{x.relationships.length===0?$(A):$(s,!1)})}o(H,S),de()}var ca=p('<p class="empty svelte-14bzost">No evidence records.</p>'),pa=p('<span class="confidence svelte-14bzost"> </span>'),_a=p('<button class="expand-btn svelte-14bzost"> </button>'),fa=p('<div><p class="svelte-14bzost"> </p></div> <!>',1),ha=p('<li class="evidence-item svelte-14bzost"><div class="evidence-header svelte-14bzost"><a href="/documents" class="doc-link svelte-14bzost"> </a> <!></div> <!></li>'),ya=p('<ul class="evidence-list svelte-14bzost"></ul>');function ua(H,x){oe(x,!0);let S=Q(We(new Set));function J(h){const l=new Set(e(S));l.has(h)?l.delete(h):l.add(h),F(S,l,!0)}var A=le(),s=R(A);{var $=h=>{var l=ca();o(h,l)},m=h=>{var l=ya();ce(l,21,()=>x.evidence,pe,(M,y)=>{var E=ha(),L=t(E),C=t(L),O=t(C);a(C);var I=n(C,2);{var P=_=>{var r=pa(),v=t(r);a(r),f(k=>i(v,`${k??""}% confidence`),[()=>Math.round(e(y).extraction_confidence*100)]),o(_,r)};g(I,_=>{e(y).extraction_confidence!=null&&_(P)})}a(L);var j=n(L,2);{var T=_=>{var r=fa(),v=R(r);let k;var z=t(v),D=t(z,!0);a(z),a(v);var b=n(v,2);{var G=u=>{var N=_a();N.__click=()=>J(e(y).id);var W=t(N,!0);a(N),f(U=>i(W,U),[()=>e(S).has(e(y).id)?"Show less":"Show more"]),o(u,N)};g(b,u=>{e(y).evidence_text.length>200&&u(G)})}f(u=>{k=na(v,1,"evidence-text svelte-14bzost",null,k,u),i(D,e(y).evidence_text)},[()=>({expanded:e(S).has(e(y).id)})]),o(_,r)};g(j,_=>{e(y).evidence_text&&_(T)})}a(E),f(()=>i(O,`Document #${e(y).document_id??""}`)),o(M,E)}),a(l),o(h,l)};g(s,h=>{x.evidence.length===0?h($):h(m,!1)})}o(H,A),de()}Qe(["click"]);var ga=p('<div class="alert alert-error"> </div>'),ma=p('<div class="loading"><div class="spinner"></div></div>'),xa=p('<span class="subtype-badge svelte-1ntfpny"> </span>'),ba=p('<span class="method-badge svelte-1ntfpny"> </span>'),wa=p('<div class="card info-card svelte-1ntfpny"><h2 class="svelte-1ntfpny">Location</h2> <p class="svelte-1ntfpny"> </p></div>'),$a=p('<div class="attr-row svelte-1ntfpny"><dt class="svelte-1ntfpny"> </dt> <dd class="svelte-1ntfpny"> </dd></div>'),ka=p('<div class="card info-card svelte-1ntfpny"><h2 class="svelte-1ntfpny">Attributes</h2> <dl class="attrs-list svelte-1ntfpny"></dl></div>'),za=p("<span> </span>"),Na=p("<span> </span>"),Sa=p('<div class="entity-header svelte-1ntfpny"><div class="header-main svelte-1ntfpny"><h1 class="svelte-1ntfpny"> </h1> <div class="header-badges svelte-1ntfpny"><span class="type-badge svelte-1ntfpny"> </span> <!> <!></div></div> <div class="header-confidence svelte-1ntfpny"><span class="confidence-label svelte-1ntfpny">Confidence</span> <div class="confidence-bar-large svelte-1ntfpny"><div class="confidence-fill-large svelte-1ntfpny"></div></div> <span class="confidence-value svelte-1ntfpny"> </span></div></div> <div class="detail-grid svelte-1ntfpny"><div class="detail-section svelte-1ntfpny"><!> <!> <div class="card info-card svelte-1ntfpny"><h2 class="svelte-1ntfpny"> </h2> <!></div></div> <div class="detail-section svelte-1ntfpny"><div class="card info-card svelte-1ntfpny"><h2 class="svelte-1ntfpny"> </h2> <!></div> <div class="card info-card svelte-1ntfpny"><h2 class="svelte-1ntfpny"> </h2> <!></div></div></div> <div class="meta-footer svelte-1ntfpny"><!> <!></div>',1),Ea=p('<div class="container"><nav class="breadcrumb svelte-1ntfpny"><a href="/knowledge-graph" class="svelte-1ntfpny">Knowledge Graph</a> <span class="sep svelte-1ntfpny">/</span> <span> </span></nav> <!> <!></div>');function Ha(H,x){oe(x,!0);const S=()=>ta(ra,"$page",J),[J,A]=aa();let s=Q(null),$=Q(!0),m=Q("");const h={HazardType:"#dc2626",Community:"#2563eb",Agency:"#7c3aed",Location:"#059669",Resource:"#d97706",Action:"#0891b2"};let l=B(()=>e(s)&&h[e(s).entity_type]||"#6b7280"),M=B(()=>e(s)?Math.round(e(s).confidence_score*100):0);Ve(async()=>{const r=Number(S().params.id);if(isNaN(r)){F(m,"Invalid entity ID"),F($,!1);return}try{F(s,await sa.knowledgeGraph.getEntity(r),!0)}catch(v){F(m,v instanceof Error?v.message:"Failed to load entity",!0)}finally{F($,!1)}});let y=B(()=>{var r;return(r=e(s))!=null&&r.attributes?Object.entries(e(s).attributes).filter(([,v])=>v!=null):[]});var E=Ea();ea("1ntfpny",r=>{Xe(()=>{var v;Ye.title=`${(((v=e(s))==null?void 0:v.name)||"Entity")??""} - Knowledge Graph`})});var L=t(E),C=n(t(L),4),O=t(C,!0);a(C),a(L);var I=n(L,2);{var P=r=>{var v=ga(),k=t(v,!0);a(v),f(()=>i(k,e(m))),o(r,v)};g(I,r=>{e(m)&&r(P)})}var j=n(I,2);{var T=r=>{var v=ma();o(r,v)},_=r=>{var v=le(),k=R(v);{var z=D=>{var b=Sa(),G=R(b),u=t(G),N=t(u),W=t(N,!0);a(N);var U=n(N,2),q=t(U),Ne=t(q,!0);a(q);var _e=n(q,2);{var Se=d=>{var c=xa(),w=t(c,!0);a(c),f(()=>i(w,e(s).entity_subtype)),o(d,c)};g(_e,d=>{e(s).entity_subtype&&d(Se)})}var Ee=n(_e,2);{var Le=d=>{var c=ba(),w=t(c,!0);a(c),f(()=>i(w,e(s).extraction_method)),o(d,c)};g(Ee,d=>{e(s).extraction_method&&d(Le)})}a(U),a(u);var fe=n(u,2),X=n(t(fe),2),De=t(X);a(X);var Y=n(X,2),Ge=t(Y);a(Y),a(fe),a(G);var Z=n(G,2),ee=t(Z),he=t(ee);{var Me=d=>{var c=wa(),w=n(t(c),2),K=t(w,!0);a(w),a(c),f(()=>i(K,e(s).location_text)),o(d,c)};g(he,d=>{e(s).location_text&&d(Me)})}var ye=n(he,2);{var Ce=d=>{var c=ka(),w=n(t(c),2);ce(w,21,()=>e(y),pe,(K,Pe)=>{var we=B(()=>Ze(e(Pe),2));let Te=()=>e(we)[0],ne=()=>e(we)[1];var ve=$a(),ie=t(ve),Ue=t(ie,!0);a(ie);var $e=n(ie,2),qe=t($e,!0);a($e),a(ve),f(Be=>{i(Ue,Te()),i(qe,Be)},[()=>typeof ne()=="object"?JSON.stringify(ne()):String(ne())]),o(K,ve)}),a(w),a(c),o(d,c)};g(ye,d=>{e(y).length>0&&d(Ce)})}var ue=n(ye,2),ae=t(ue),Ie=t(ae);a(ae);var Ke=n(ae,2);ua(Ke,{get evidence(){return e(s).evidence}}),a(ue),a(ee);var ge=n(ee,2),te=t(ge),re=t(te),Re=t(re);a(re);var Ae=n(re,2);ze(Ae,{get relationships(){return e(s).outgoing_relationships},direction:"outgoing",get entityName(){return e(s).name}}),a(te);var me=n(te,2),se=t(me),Oe=t(se);a(se);var je=n(se,2);ze(je,{get relationships(){return e(s).incoming_relationships},direction:"incoming",get entityName(){return e(s).name}}),a(me),a(ge),a(Z);var xe=n(Z,2),be=t(xe);{var Fe=d=>{var c=za(),w=t(c);a(c),f(K=>i(w,`Created: ${K??""}`),[()=>new Date(e(s).created_at).toLocaleDateString()]),o(d,c)};g(be,d=>{e(s).created_at&&d(Fe)})}var He=n(be,2);{var Je=d=>{var c=Na(),w=t(c);a(c),f(K=>i(w,`Updated: ${K??""}`),[()=>new Date(e(s).updated_at).toLocaleDateString()]),o(d,c)};g(He,d=>{e(s).updated_at&&d(Je)})}a(xe),f(()=>{i(W,e(s).name),V(q,`color: ${e(l)??""}; border-color: ${e(l)??""}`),i(Ne,e(s).entity_type),V(De,`width: ${e(M)??""}%; background: ${e(l)??""}`),V(Y,`color: ${e(l)??""}`),i(Ge,`${e(M)??""}%`),i(Ie,`Evidence (${e(s).evidence.length??""})`),i(Re,`Outgoing Relationships (${e(s).outgoing_relationships.length??""})`),i(Oe,`Incoming Relationships (${e(s).incoming_relationships.length??""})`)}),o(D,b)};g(k,D=>{e(s)&&D(z)},!0)}o(r,v)};g(j,r=>{e($)?r(T):r(_,!1)})}a(E),f(()=>{var r;return i(O,((r=e(s))==null?void 0:r.name)||"Loading...")}),o(H,E),de(),A()}export{Ha as component};
