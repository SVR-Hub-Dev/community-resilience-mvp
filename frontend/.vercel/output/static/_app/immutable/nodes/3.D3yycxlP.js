import{d as Fa,a as n,f as _,s as p,c as Ia,e as La}from"../chunks/DrEVJf_X.js";import{o as Ma}from"../chunks/CY6dNTIf.js";import{a0 as Pa,a8 as g,ab as Va,aa as na,a1 as f,a2 as Ja,e as Na,b as o,a5 as Ta,a3 as v,a4 as e,g as t,a7 as a,a9 as da}from"../chunks/BIQOLOFU.js";import{i as y}from"../chunks/NPzolRrf.js";import{e as ja,i as qa}from"../chunks/BPKzcg-U.js";import{h as za}from"../chunks/82X_sTQh.js";import{r as Ba,s as ca}from"../chunks/CDiOZD_h.js";import{s as pa}from"../chunks/DrIL6A14.js";import{a as Ga}from"../chunks/COIuQCY0.js";import{b as Ha}from"../chunks/D8D42rjB.js";import{g as Ka}from"../chunks/D1v8bg46.js";import{a as Z,g as Oa}from"../chunks/D6zz_Kj-.js";var Qa=_('<div class="error-banner svelte-1p497kv"> </div>'),Wa=_('<div class="loading svelte-1p497kv">Loading...</div>'),Xa=_('<div class="empty-state svelte-1p497kv"><p>No users found.</p></div>'),Ya=_('<img alt="" class="user-avatar svelte-1p497kv"/>'),Za=_('<span class="user-avatar-placeholder svelte-1p497kv"> </span>'),$a=_('<button class="btn btn-danger btn-sm svelte-1p497kv">Delete</button>'),ae=_('<tr><td class="svelte-1p497kv"><div class="user-info svelte-1p497kv"><!> <div><span class="user-name svelte-1p497kv"> </span> <span class="user-email svelte-1p497kv"> </span></div></div></td><td class="svelte-1p497kv"><span> </span></td><td class="svelte-1p497kv"> </td><td class="svelte-1p497kv"><span> </span></td><td class="svelte-1p497kv"> </td><td class="svelte-1p497kv"><div class="actions svelte-1p497kv"><button class="btn btn-secondary btn-sm svelte-1p497kv">Edit</button> <!></div></td></tr>'),ee=_('<table class="table svelte-1p497kv"><thead><tr><th class="svelte-1p497kv">User</th><th class="svelte-1p497kv">Role</th><th class="svelte-1p497kv">Provider</th><th class="svelte-1p497kv">Status</th><th class="svelte-1p497kv">Joined</th><th class="svelte-1p497kv"></th></tr></thead><tbody></tbody></table>'),te=_('<img alt="" class="user-avatar svelte-1p497kv"/>'),se=_('<span class="user-avatar-placeholder svelte-1p497kv"> </span>'),ve=_('<div class="modal-overlay svelte-1p497kv"><div class="modal svelte-1p497kv"><h2 class="svelte-1p497kv">Edit User</h2> <div class="user-info modal-user svelte-1p497kv"><!> <div><span class="user-name svelte-1p497kv"> </span> <span class="user-email svelte-1p497kv"> </span></div></div> <form><div class="form-group svelte-1p497kv"><label for="role" class="svelte-1p497kv">Role</label> <select id="role" class="svelte-1p497kv"><option>Viewer</option><option>Editor</option><option>Admin</option></select></div> <div class="form-group svelte-1p497kv"><label class="checkbox-label svelte-1p497kv"><input type="checkbox" class="svelte-1p497kv"/> <span>Account is active</span></label></div> <div class="modal-actions svelte-1p497kv"><button type="button" class="btn btn-secondary svelte-1p497kv">Cancel</button> <button type="submit" class="btn btn-primary svelte-1p497kv">Save Changes</button></div></form></div></div>'),re=_('<div class="container"><div class="page-header svelte-1p497kv"><h1 class="svelte-1p497kv">Manage Users</h1> <p class="svelte-1p497kv">View and manage user accounts and roles.</p></div> <!> <div class="card svelte-1p497kv"><div class="card-header svelte-1p497kv"><h2 class="svelte-1p497kv"> </h2></div> <!></div></div> <!>',1);function he(_a,ua){Pa(ua,!0);const B=Oa();let G=g(Va([])),$=g(0),H=g(!0),x=g(null),u=g(null),T=g("viewer"),j=g(!0);Ma(async()=>{if(!B.isAuthenticated||!B.isAdmin){Ka("/");return}await K()});async function K(){o(H,!0),o(x,null);try{const s=await Z.auth.admin.getUsers({limit:100});o(G,s.users,!0),o($,s.total,!0)}catch(s){o(x,s instanceof Error?s.message:"Failed to load users",!0)}o(H,!1)}function ma(s){o(u,s,!0),o(T,s.role,!0),o(j,s.is_active,!0)}function aa(){o(u,null)}async function ka(){if(t(u))try{await Z.auth.admin.updateUser(t(u).id,{role:t(T),is_active:t(j)}),await K(),o(u,null)}catch(s){o(x,s instanceof Error?s.message:"Failed to update user",!0)}}async function fa(s){if(confirm(`Are you sure you want to delete ${s.name}? This will also delete all their API keys and sessions.`))try{await Z.auth.admin.deleteUser(s.id),await K()}catch(r){o(x,r instanceof Error?r.message:"Failed to delete user",!0)}}var ea=re();za("1p497kv",s=>{Na(()=>{Ta.title="Manage Users - Community Resilience"})});var O=na(ea),ta=v(e(O),2);{var ha=s=>{var r=Qa(),h=e(r,!0);a(r),f(()=>p(h,t(x))),n(s,r)};y(ta,s=>{t(x)&&s(ha)})}var sa=v(ta,2),Q=e(sa),va=e(Q),ba=e(va);a(va),a(Q);var ga=v(Q,2);{var ya=s=>{var r=Wa();n(s,r)},xa=s=>{var r=Ia(),h=na(r);{var R=k=>{var b=Xa();n(k,b)},q=k=>{var b=ee(),S=v(e(b));ja(S,21,()=>t(G),qa,(F,l)=>{var w=ae(),I=e(w),U=e(I),A=e(U);{var L=d=>{var c=Ya();f(()=>ca(c,"src",t(l).avatar_url)),n(d,c)},M=d=>{var c=Za(),Ra=e(c,!0);a(c),f(Sa=>p(Ra,Sa),[()=>t(l).name.charAt(0).toUpperCase()]),n(d,c)};y(A,d=>{t(l).avatar_url?d(L):d(M,!1)})}var E=v(A,2),C=e(E),P=e(C,!0);a(C);var V=v(C,2),z=e(V,!0);a(V),a(E),a(U),a(I);var D=v(I),J=e(D),i=e(J,!0);a(J),a(D);var m=v(D),W=e(m,!0);a(m);var N=v(m),X=e(N);let ra;var Aa=e(X,!0);a(X),a(N);var Y=v(N),Ea=e(Y,!0);a(Y);var la=v(Y),ia=e(la),oa=e(ia);oa.__click=()=>ma(t(l));var Ca=v(oa,2);{var Da=d=>{var c=$a();c.__click=()=>fa(t(l)),n(d,c)};y(Ca,d=>{var c;t(l).id!==((c=B.user)==null?void 0:c.id)&&d(Da)})}a(ia),a(la),a(w),f(d=>{p(P,t(l).name),p(z,t(l).email),pa(J,1,`role-badge role-${t(l).role??""}`,"svelte-1p497kv"),p(i,t(l).role),p(W,t(l).oauth_provider||"-"),ra=pa(X,1,"status-badge svelte-1p497kv",null,ra,{active:t(l).is_active}),p(Aa,t(l).is_active?"Active":"Inactive"),p(Ea,d)},[()=>new Date(t(l).created_at).toLocaleDateString()]),n(F,w)}),a(S),a(b),n(k,b)};y(h,k=>{t(G).length===0?k(R):k(q,!1)},!0)}n(s,r)};y(ga,s=>{t(H)?s(ya):s(xa,!1)})}a(sa),a(O);var wa=v(O,2);{var Ua=s=>{var r=ve();r.__click=aa;var h=e(r);h.__click=i=>i.stopPropagation();var R=v(e(h),2),q=e(R);{var k=i=>{var m=te();f(()=>ca(m,"src",t(u).avatar_url)),n(i,m)},b=i=>{var m=se(),W=e(m,!0);a(m),f(N=>p(W,N),[()=>t(u).name.charAt(0).toUpperCase()]),n(i,m)};y(q,i=>{t(u).avatar_url?i(k):i(b,!1)})}var S=v(q,2),F=e(S),l=e(F,!0);a(F);var w=v(F,2),I=e(w,!0);a(w),a(S),a(R);var U=v(R,2),A=e(U),L=v(e(A),2),M=e(L);M.value=M.__value="viewer";var E=v(M);E.value=E.__value="editor";var C=v(E);C.value=C.__value="admin",a(L),a(A);var P=v(A,2),V=e(P),z=e(V);Ba(z),da(2),a(V),a(P);var D=v(P,2),J=e(D);J.__click=aa,da(2),a(D),a(U),a(h),a(r),f(()=>{p(l,t(u).name),p(I,t(u).email)}),La("submit",U,i=>{i.preventDefault(),ka()}),Ha(L,()=>t(T),i=>o(T,i)),Ga(z,()=>t(j),i=>o(j,i)),n(s,r)};y(wa,s=>{t(u)&&s(Ua)})}f(()=>p(ba,`Users (${t($)??""})`)),n(_a,ea),Ja()}Fa(["click"]);export{he as component};
