import{b as ce,g as Re,d as Ne,e as de,a as g,f as A,s as k,t as ue,c as Fe}from"../chunks/DrEVJf_X.js";import{o as Le}from"../chunks/CY6dNTIf.js";import{a1 as C,h as ve,j as pe,ai as je,aj as Ie,u as fe,C as Ue,O as Ye,ak as Ge,al as He,o as Qe,P as N,a0 as Ve,ac as ze,g as s,a2 as Be,b as a,e as Je,a4 as i,a3 as o,a8 as P,a5 as Ke,a9 as Z,a7 as l,aa as me}from"../chunks/BIQOLOFU.js";import{i as M}from"../chunks/NPzolRrf.js";import{h as We}from"../chunks/82X_sTQh.js";import{r as E,a as $}from"../chunks/CDiOZD_h.js";import{b as F}from"../chunks/COIuQCY0.js";import{g as Xe}from"../chunks/D1v8bg46.js";import{g as Ze,a as O,u as ee}from"../chunks/D6zz_Kj-.js";import{s as $e,g as et}from"../chunks/DJgaem7h.js";function tt(L,j,v=!1,r=!1,d=!1){var m=L,w="";C(()=>{var p=je;if(w===(w=j()??"")){ve&&pe();return}if(p.nodes!==null&&(Ie(p.nodes.start,p.nodes.end),p.nodes=null),w!==""){if(ve){fe.data;for(var c=pe(),y=c;c!==null&&(c.nodeType!==Ue||c.data!=="");)y=c,c=Ye(c);if(c===null)throw Ge(),He;ce(fe,y),m=Qe(c);return}var h=w+"";v?h=`<svg>${h}</svg>`:r&&(h=`<math>${h}</math>`);var u=Re(h);if((v||r)&&(u=N(u)),ce(N(u),u.lastChild),v||r)for(;N(u);)m.before(N(u));else m.before(u)}})}var at=A('<div class="message error-message svelte-1i19ct2"> </div>'),st=A('<div class="message success-message svelte-1i19ct2"> </div>'),rt=A('<label for="current-password" class="svelte-1i19ct2">Current password</label> <input id="current-password" type="password" required autocomplete="current-password" class="svelte-1i19ct2"/>',1),it=A(`<div class="totp-setup svelte-1i19ct2"><p class="svelte-1i19ct2">Scan this QR code with your authenticator app (Google Authenticator, Microsoft Authenticator, Authy, etc.):</p> <div class="qr-code svelte-1i19ct2"><!></div> <details class="manual-entry svelte-1i19ct2"><summary class="svelte-1i19ct2">Can't scan? Enter this key manually</summary> <code class="secret-key svelte-1i19ct2"> </code></details> <form class="verify-form svelte-1i19ct2"><label for="totp-verify" class="svelte-1i19ct2">Enter the 6-digit code from your app to confirm setup:</label> <input id="totp-verify" type="text" placeholder="000000" maxlength="6" pattern="[0-9]*" inputmode="numeric" autocomplete="one-time-code" class="totp-input svelte-1i19ct2" required/> <div class="button-row svelte-1i19ct2"><button type="submit" class="btn btn-primary svelte-1i19ct2"> </button> <button type="button" class="btn btn-secondary svelte-1i19ct2">Cancel</button></div></form></div>`),ot=A('<div class="totp-status enabled svelte-1i19ct2"><span class="status-badge svelte-1i19ct2">Enabled</span> <p class="svelte-1i19ct2">Two-factor authentication is active on your account.</p> <button class="btn btn-danger svelte-1i19ct2"> </button></div>'),lt=A('<div class="totp-status disabled svelte-1i19ct2"><span class="status-badge off svelte-1i19ct2">Not enabled</span> <p class="svelte-1i19ct2">Protect your account with a time-based one-time password.</p> <button class="btn btn-primary svelte-1i19ct2"> </button></div>'),nt=A('<div class="settings-container svelte-1i19ct2"><h1 class="svelte-1i19ct2">Settings</h1> <section class="settings-section svelte-1i19ct2"><h2 class="svelte-1i19ct2">Theme</h2> <p class="section-description svelte-1i19ct2">Choose your preferred color mode.</p> <div class="theme-switch svelte-1i19ct2"><label class="svelte-1i19ct2"><input type="radio" name="theme" value="light"/> Light</label> <label class="svelte-1i19ct2"><input type="radio" name="theme" value="dark"/> Dark</label> <label class="svelte-1i19ct2"><input type="radio" name="theme" value="system"/> System</label></div></section> <!> <!> <section class="settings-section svelte-1i19ct2"><h2 class="svelte-1i19ct2">Password</h2> <p class="section-description svelte-1i19ct2"><!></p> <form class="password-form svelte-1i19ct2"><!> <label for="new-password" class="svelte-1i19ct2"> </label> <input id="new-password" type="password" required minlength="8" autocomplete="new-password" class="svelte-1i19ct2"/> <label for="confirm-password" class="svelte-1i19ct2">Confirm password</label> <input id="confirm-password" type="password" required minlength="8" autocomplete="new-password" class="svelte-1i19ct2"/> <button type="submit" class="btn btn-primary svelte-1i19ct2"> </button></form></section> <section class="settings-section svelte-1i19ct2"><h2 class="svelte-1i19ct2">Two-Factor Authentication (TOTP)</h2> <p class="section-description svelte-1i19ct2">Add an extra layer of security by requiring a code from your authenticator app when you sign in.</p> <!></section></div>');function gt(L,j){Ve(j,!0);const v=Ze();let r=P(!1),d=P(null),m=P(null),w=P(""),p=P(""),c=P(""),y=P(null),h=P(""),u=P("system");Le(()=>{a(u,et(),!0)});function I(e){const t=e.target.value;a(u,t,!0),$e(s(u))}ze(()=>{!v.isLoading&&!v.isAuthenticated&&Xe("/auth/login")});async function he(){a(r,!0),a(d,null),a(m,null);try{a(y,await O.auth.setupTotp(),!0)}catch(e){a(d,e instanceof Error?e.message:"Failed to start TOTP setup",!0)}finally{a(r,!1)}}async function _e(e){e.preventDefault(),a(r,!0),a(d,null);try{await O.auth.verifyTotpSetup(s(h));const t=await O.auth.getMe();ee(t),a(y,null),a(h,""),a(m,"Two-factor authentication has been enabled.")}catch(t){a(d,t instanceof Error?t.message:"Invalid code",!0)}finally{a(r,!1)}}async function be(){a(r,!0),a(d,null),a(m,null);try{await O.auth.disableTotp();const e=await O.auth.getMe();ee(e),a(m,"Two-factor authentication has been disabled.")}catch(e){a(d,e instanceof Error?e.message:"Failed to disable TOTP",!0)}finally{a(r,!1)}}async function ge(e){var t,n;if(e.preventDefault(),a(d,null),a(m,null),s(p).length<8){a(d,"Password must be at least 8 characters.");return}if(s(p)!==s(c)){a(d,"Passwords do not match.");return}a(r,!0);try{const b={new_password:s(p)};(t=v.user)!=null&&t.has_password&&(b.current_password=s(w)),await O.auth.setPassword(b);const x=await O.auth.getMe();ee(x),a(w,""),a(p,""),a(c,""),a(m,(n=v.user)!=null&&n.has_password?"Password has been changed.":"Password has been set. You can now sign in with email and password.",!0)}catch(b){a(d,b instanceof Error?b.message:"Failed to set password",!0)}finally{a(r,!1)}}function we(){a(y,null),a(h,""),a(d,null)}var U=nt();We("1i19ct2",e=>{Je(()=>{Ke.title="Settings - Community Resilience"})});var Y=o(i(U),2),te=o(i(Y),4),G=i(te),H=i(G);E(H),H.__change=I,Z(),l(G);var Q=o(G,2),V=i(Q);E(V),V.__change=I,Z(),l(Q);var ae=o(Q,2),z=i(ae);E(z),z.__change=I,Z(),l(ae),l(te),l(Y);var se=o(Y,2);{var ye=e=>{var t=at(),n=i(t,!0);l(t),C(()=>k(n,s(d))),g(e,t)};M(se,e=>{s(d)&&e(ye)})}var re=o(se,2);{var Te=e=>{var t=st(),n=i(t,!0);l(t),C(()=>k(n,s(m))),g(e,t)};M(re,e=>{s(m)&&e(Te)})}var B=o(re,2),J=o(i(B),2),Pe=i(J);{var Se=e=>{var t=ue("Change your password for email/password sign-in.");g(e,t)},ke=e=>{var t=ue("Set a password to enable offline sign-in with your email and password.");g(e,t)};M(Pe,e=>{var t;(t=v.user)!=null&&t.has_password?e(Se):e(ke,!1)})}l(J);var K=o(J,2),ie=i(K);{var Ce=e=>{var t=rt(),n=o(me(t),2);E(n),C(()=>n.disabled=s(r)),F(n,()=>s(w),b=>a(w,b)),g(e,t)};M(ie,e=>{var t;(t=v.user)!=null&&t.has_password&&e(Ce)})}var W=o(ie,2),xe=i(W,!0);l(W);var q=o(W,2);E(q);var D=o(q,4);E(D);var X=o(D,2),Ee=i(X,!0);l(X),l(K),l(B);var oe=o(B,2),Oe=o(i(oe),4);{var Ae=e=>{var t=it(),n=o(i(t),2),b=i(n);tt(b,()=>s(y).qr_svg),l(n);var x=o(n,2),T=o(i(x),2),_=i(T,!0);l(T),l(x);var f=o(x,2),S=o(i(f),2);E(S);var le=o(S,2),R=i(le),qe=i(R,!0);l(R);var ne=o(R,2);ne.__click=we,l(le),l(f),l(t),C(()=>{k(_,s(y).secret),S.disabled=s(r),R.disabled=s(r)||s(h).length<6,k(qe,s(r)?"Verifying...":"Enable TOTP"),ne.disabled=s(r)}),de("submit",f,_e),F(S,()=>s(h),De=>a(h,De)),g(e,t)},Me=e=>{var t=Fe(),n=me(t);{var b=T=>{var _=ot(),f=o(i(_),4);f.__click=be;var S=i(f,!0);l(f),l(_),C(()=>{f.disabled=s(r),k(S,s(r)?"Disabling...":"Disable TOTP")}),g(T,_)},x=T=>{var _=lt(),f=o(i(_),4);f.__click=he;var S=i(f,!0);l(f),l(_),C(()=>{f.disabled=s(r),k(S,s(r)?"Setting up...":"Set Up TOTP")}),g(T,_)};M(n,T=>{var _;(_=v.user)!=null&&_.totp_enabled?T(b):T(x,!1)},!0)}g(e,t)};M(Oe,e=>{s(y)?e(Ae):e(Me,!1)})}l(oe),l(U),C(()=>{var e,t;$(H,s(u)==="light"),$(V,s(u)==="dark"),$(z,s(u)==="system"),k(xe,(e=v.user)!=null&&e.has_password?"New password":"Password"),q.disabled=s(r),D.disabled=s(r),X.disabled=s(r)||s(p).length<8||s(p)!==s(c),k(Ee,s(r)?"Saving...":(t=v.user)!=null&&t.has_password?"Change Password":"Set Password")}),de("submit",K,ge),F(q,()=>s(p),e=>a(p,e)),F(D,()=>s(c),e=>a(c,e)),g(L,U),Be()}Ne(["change","click"]);export{gt as component};
