# üóÑÔ∏è **Core Data Schemas for a Community‚ÄëKnowledge Disaster System**

Below are the four foundational entities you‚Äôll want in our MVP:

1. **Community Knowledge Entry**  
2. **Community Event (real‚Äëtime or historical)**  
3. **Community Asset (places, resources, infrastructure)**  
4. **Feedback Log (for improving the model)**  

Each schema is intentionally compact but expressive enough to support reasoning, retrieval, and future expansion.

---

## üß† 1. **community_knowledge**  

This is our ‚Äúlocal wisdom‚Äù table ‚Äî past experiences, patterns, stories, hazard notes.

### **Purpose ‚Äî community_knowledge**

- Provide context for the reasoning model  
- Support vector similarity search  
- Capture unstructured community knowledge  

### **Schema (community_knowledge)**

```sql
CREATE TABLE community_knowledge (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    description TEXT NOT NULL,
    tags TEXT[],
    location TEXT,
    hazard_type TEXT,          -- e.g., 'flood', 'fire', 'storm'
    source TEXT,               -- e.g., 'community workshop', 'elder interview'
    embedding VECTOR(1536),    -- pgvector
    created_at TIMESTAMP DEFAULT NOW()
);
```

### **Example Record (community_knowledge)**

```json
{
  "title": "Riverside Street Flooding Pattern",
  "description": "Riverside Street floods after heavy rain above 100mm. Elderly residents often become isolated.",
  "tags": ["flood", "elderly", "mobility"],
  "location": "Riverside Street",
  "hazard_type": "flood",
  "source": "community meeting"
}
```

---

## üìÖ 2. **community_event**  

This captures **real‚Äëtime reports** or **historical incidents**.

### **Purpose ‚Äî community_event**

- Feed the reasoning model during response  
- Build a historical dataset for future training  
- Track what actually happened  

### **Schema (community_event)**

```sql
CREATE TABLE community_event (
    id SERIAL PRIMARY KEY,
    event_type TEXT NOT NULL,      -- 'flood', 'fire', 'power_outage', etc.
    description TEXT NOT NULL,
    location TEXT,
    severity INTEGER,              -- 1‚Äì5 scale
    reported_by TEXT,              -- optional: name, group, or channel
    timestamp TIMESTAMP DEFAULT NOW(),
    embedding VECTOR(1536)         -- optional: for similarity search
);
```

### **Example Record (community_event)**

```json
{
  "event_type": "flood",
  "description": "Water rising quickly on Riverside Street, power out, two homes already inaccessible.",
  "location": "Riverside Street",
  "severity": 4,
  "reported_by": "local volunteer"
}
```

---

## üèõÔ∏è 3. **community_asset**  

Assets are **places, resources, infrastructure, and capacities**.

### **Purpose ‚Äî community_asset**

- Help the model recommend shelters, routes, resources  
- Support preparedness and recovery planning  
- Provide structured, queryable local infrastructure data  

### **Schema (community_asset)**

```sql
CREATE TABLE community_asset (
    id SERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    asset_type TEXT NOT NULL,      -- 'shelter', 'road', 'bridge', 'clinic', 'resource'
    description TEXT,
    location TEXT,
    capacity INTEGER,              -- e.g., shelter capacity
    status TEXT,                   -- 'operational', 'damaged', 'unknown'
    tags TEXT[],
    embedding VECTOR(1536),        -- optional
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### **Example Record (community_asset)**

```json
{
  "name": "Hilltop Community Hall",
  "asset_type": "shelter",
  "description": "Backup generator, accessible toilets, used during past floods.",
  "location": "Hilltop Road",
  "capacity": 120,
  "status": "operational",
  "tags": ["shelter", "generator", "accessible"]
}
```

---

## ‚≠ê 4. **model_feedback_log**  

This is our ‚Äúlearning loop‚Äù table.

### **Purpose ‚Äî model_feedback_log**

- Track how well the model performed  
- Store retrieved knowledge + model output  
- Build a dataset for future fine‚Äëtuning  

### **Schema (model_feedback_log)**

```sql
CREATE TABLE model_feedback_log (
    id SERIAL PRIMARY KEY,
    user_input TEXT NOT NULL,
    retrieved_knowledge_ids INT[],
    retrieved_asset_ids INT[],
    model_output TEXT NOT NULL,
    rating INTEGER,                -- 1‚Äì5
    comments TEXT,
    timestamp TIMESTAMP DEFAULT NOW()
);
```

### **Example Record**

```json
{
  "user_input": "Riverside Street underwater, power out.",
  "retrieved_knowledge_ids": [3, 7],
  "retrieved_asset_ids": [2],
  "model_output": "1. Evacuate elderly residents... 2. Activate Hilltop Hall...",
  "rating": 4,
  "comments": "Good but missed that the bridge is closed."
}
```

---

## üîó How These Schemas Work Together

### **During a disaster**

- User submits a situation  
- Backend embeds it  
- Retrieves:
  - community_knowledge  
  - community_asset  
  - community_event (optional)  
- LLM reasons over the combined context  
- Output is logged in model_feedback_log  

### **Before a disaster**

- community_asset supports preparedness planning  
- community_knowledge supports drills and education  

### **After a disaster**

- community_event becomes part of the historical record  
- community_asset status updates feed recovery planning  

---
