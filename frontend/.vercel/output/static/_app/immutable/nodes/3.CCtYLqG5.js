import"../chunks/CWj6FrbW.js";import{o as Ta}from"../chunks/DN4i8kDz.js";import{a1 as Va,a2 as Ja,W as y,ah as Na,ag as pa,a3 as b,a5 as d,a6 as Oa,e as Wa,a8 as c,b as p,aa as ja,a7 as i,a9 as t,g as a,ac as e,af as _,ai as qa,ad as ca,a4 as za}from"../chunks/BkQX6IBl.js";import{i as h}from"../chunks/CmSFReHR.js";import{e as Ba,i as Ga}from"../chunks/DL943SAc.js";import{h as Ha}from"../chunks/DN-AoazC.js";import{r as Ka,s as _a}from"../chunks/TY_SEvFQ.js";import{s as ua}from"../chunks/t6lN8a7b.js";import{a as Qa}from"../chunks/DE88cSuZ.js";import{b as Xa}from"../chunks/BrMWA5F7.js";import{g as Ya}from"../chunks/DjFSqXvx.js";import{a as ea}from"../chunks/D4n-kpo8.js";import{g as Za}from"../chunks/DQ6qqwK7.js";var $a=c('<div class="error-banner svelte-1p497kv"> </div>'),ae=c('<div class="loading svelte-1p497kv">Loading...</div>'),ee=c('<div class="empty-state svelte-1p497kv"><p>No users found.</p></div>'),te=c('<img alt="" class="user-avatar svelte-1p497kv"/>'),se=c('<span class="user-avatar-placeholder svelte-1p497kv"> </span>'),re=c('<span class="current-user-badge svelte-1p497kv">Current User</span>'),ve=c('<span class="api-only-indicator svelte-1p497kv">API Only</span>'),le=c('<button class="btn btn-secondary btn-sm svelte-1p497kv">Edit</button>'),ie=c('<button class="btn btn-danger btn-sm svelte-1p497kv">Delete</button>'),oe=c('<tr><td class="svelte-1p497kv"><div class="user-info svelte-1p497kv"><!> <div><span class="user-name svelte-1p497kv"> <!></span> <span class="user-email svelte-1p497kv"> </span></div></div></td><td class="svelte-1p497kv"><span> <!></span></td><td class="svelte-1p497kv"> </td><td class="svelte-1p497kv"><span> </span></td><td class="svelte-1p497kv"> </td><td class="svelte-1p497kv"><div class="actions svelte-1p497kv"><!> <!></div></td></tr>'),ne=c('<table class="table svelte-1p497kv"><thead><tr><th class="svelte-1p497kv">User</th><th class="svelte-1p497kv">Role</th><th class="svelte-1p497kv">Provider</th><th class="svelte-1p497kv">Status</th><th class="svelte-1p497kv">Joined</th><th class="svelte-1p497kv"></th></tr></thead><tbody></tbody></table>'),de=c('<img alt="" class="user-avatar svelte-1p497kv"/>'),pe=c('<span class="user-avatar-placeholder svelte-1p497kv"> </span>'),ce=c('<div class="modal-overlay svelte-1p497kv" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1"><div class="modal svelte-1p497kv"><h2 id="modal-title" class="svelte-1p497kv">Edit User</h2> <div class="user-info modal-user svelte-1p497kv"><!> <div><span class="user-name svelte-1p497kv"> </span> <span class="user-email svelte-1p497kv"> </span></div></div> <form><div class="form-group svelte-1p497kv"><label for="role" class="svelte-1p497kv">Role</label> <select id="role" class="svelte-1p497kv"><option>Viewer</option><option>Editor</option><option>Admin</option></select></div> <div class="form-group svelte-1p497kv"><label class="checkbox-label svelte-1p497kv"><input type="checkbox" class="svelte-1p497kv"/> <span>Account is active</span></label></div> <div class="modal-actions svelte-1p497kv"><button type="button" class="btn btn-secondary svelte-1p497kv">Cancel</button> <button type="submit" class="btn btn-primary svelte-1p497kv">Save Changes</button></div></form></div></div>'),_e=c('<div class="container"><div class="page-header svelte-1p497kv"><h1 class="svelte-1p497kv">Manage Users</h1> <p class="svelte-1p497kv">View and manage user accounts and roles.</p></div> <!> <div class="card svelte-1p497kv"><div class="card-header svelte-1p497kv"><h2 class="svelte-1p497kv"> </h2></div> <!></div></div> <!>',1);function Ce(ma,ka){Ja(ka,!0);const m=Za();let q=y(Na([])),ta=y(0),z=y(!0),x=y(null),u=y(null),V=y("viewer"),J=y(!0);Ta(async()=>{setTimeout(async()=>{if(console.log("Admin users page mount - auth state:",{isAuthenticated:m.isAuthenticated,isAdmin:m.isAdmin,user:m.user}),!m.isAuthenticated||!m.isAdmin){console.log("Redirecting - not authenticated or not admin"),Ya("/");return}console.log("Loading users..."),await B()},100)});async function B(){p(z,!0),p(x,null);try{const s=await ea.auth.admin.getUsers({limit:100});p(q,s.users,!0),p(ta,s.total,!0)}catch(s){p(x,s instanceof Error?s.message:"Failed to load users",!0)}p(z,!1)}function ha(s){p(u,s,!0),p(V,s.role,!0),p(J,s.is_active,!0)}function G(){p(u,null)}async function fa(){if(a(u))try{await ea.auth.admin.updateUser(a(u).id,{role:a(V),is_active:a(J)}),await B(),p(u,null)}catch(s){p(x,s instanceof Error?s.message:"Failed to update user",!0)}}async function ba(s){if(confirm(`Are you sure you want to delete ${s.name}? This will also delete all their API keys and sessions.`))try{await ea.auth.admin.deleteUser(s.id),await B()}catch(n){p(x,n instanceof Error?n.message:"Failed to delete user",!0)}}var sa=_e();Ha("1p497kv",s=>{Wa(()=>{ja.title="Manage Users - Community Resilience"})});var H=pa(sa),ra=i(t(H),2);{var ga=s=>{var n=$a(),A=t(n,!0);e(n),b(()=>_(A,a(x))),d(s,n)};h(ra,s=>{a(x)&&s(ga)})}var va=i(ra,2),K=t(va),la=t(K),ya=t(la);e(la),e(K);var xa=i(K,2);{var Aa=s=>{var n=ae();d(s,n)},wa=s=>{var n=qa(),A=pa(n);{var D=f=>{var g=ee();d(f,g)},N=f=>{var g=ne(),I=i(t(g));Ba(I,21,()=>a(q),Ga,(F,r)=>{var w=oe(),L=t(w),U=t(L),E=t(U);{var M=l=>{var v=te();b(()=>_a(v,"src",a(r).avatar_url)),d(l,v)},P=l=>{var v=se(),Ma=t(v,!0);e(v),b(Pa=>_(Ma,Pa),[()=>a(r).name.charAt(0).toUpperCase()]),d(l,v)};h(E,l=>{a(r).avatar_url?l(M):l(P,!1)})}var C=i(E,2),S=t(C),R=t(S),O=i(R);{var W=l=>{var v=re();d(l,v)};h(O,l=>{var v;a(r).id===((v=m.user)==null?void 0:v.id)&&l(W)})}e(S);var T=i(S,2),Q=t(T,!0);e(T),e(C),e(U),e(L);var o=i(L),k=t(o),j=t(k),X=i(j);{var Ca=l=>{var v=ve();d(l,v)};h(X,l=>{!a(r).has_password&&a(r).oauth_provider===null&&l(Ca)})}e(k),e(o);var Y=i(o),Sa=t(Y,!0);e(Y);var Z=i(Y),$=t(Z);let ia;var Ra=t($,!0);e($),e(Z);var aa=i(Z),Da=t(aa,!0);e(aa);var oa=i(aa),na=t(oa),da=t(na);{var Ia=l=>{var v=le();v.__click=()=>ha(a(r)),d(l,v)};h(da,l=>{var v;m.isAdmin&&a(r).id!==((v=m.user)==null?void 0:v.id)&&(a(r).has_password||a(r).oauth_provider)&&l(Ia)})}var Fa=i(da,2);{var La=l=>{var v=ie();v.__click=()=>ba(a(r)),d(l,v)};h(Fa,l=>{var v;m.isAdmin&&a(r).id!==((v=m.user)==null?void 0:v.id)&&(a(r).has_password||a(r).oauth_provider)&&a(r).role!=="admin"&&l(La)})}e(na),e(oa),e(w),b(l=>{_(R,`${a(r).name??""} `),_(Q,a(r).email),ua(k,1,`role-badge role-${a(r).role??""}`,"svelte-1p497kv"),_(j,`${a(r).role??""} `),_(Sa,a(r).oauth_provider||"-"),ia=ua($,1,"status-badge svelte-1p497kv",null,ia,{active:a(r).is_active}),_(Ra,a(r).is_active?"Active":"Inactive"),_(Da,l)},[()=>new Date(a(r).created_at).toLocaleDateString()]),d(F,w)}),e(I),e(g),d(f,g)};h(A,f=>{a(q).length===0?f(D):f(N,!1)},!0)}d(s,n)};h(xa,s=>{a(z)?s(Aa):s(wa,!1)})}e(va),e(H);var Ua=i(H,2);{var Ea=s=>{var n=ce();n.__click=G,n.__keydown=o=>{o.key==="Escape"&&G()};var A=t(n),D=i(t(A),2),N=t(D);{var f=o=>{var k=de();b(()=>_a(k,"src",a(u).avatar_url)),d(o,k)},g=o=>{var k=pe(),j=t(k,!0);e(k),b(X=>_(j,X),[()=>a(u).name.charAt(0).toUpperCase()]),d(o,k)};h(N,o=>{a(u).avatar_url?o(f):o(g,!1)})}var I=i(N,2),F=t(I),r=t(F,!0);e(F);var w=i(F,2),L=t(w,!0);e(w),e(I),e(D);var U=i(D,2),E=t(U),M=i(t(E),2),P=t(M);P.value=P.__value="viewer";var C=i(P);C.value=C.__value="editor";var S=i(C);S.value=S.__value="admin",e(M),e(E);var R=i(E,2),O=t(R),W=t(O);Ka(W),ca(2),e(O),e(R);var T=i(R,2),Q=t(T);Q.__click=G,ca(2),e(T),e(U),e(A),e(n),b(()=>{_(r,a(u).name),_(L,a(u).email)}),za("submit",U,o=>{o.preventDefault(),fa()}),Xa(M,()=>a(V),o=>p(V,o)),Qa(W,()=>a(J),o=>p(J,o)),d(s,n)};h(Ua,s=>{a(u)&&s(Ea)})}b(()=>_(ya,`Users (${a(ta)??""})`)),d(ma,sa),Oa()}Va(["click","keydown"]);export{Ce as component};
