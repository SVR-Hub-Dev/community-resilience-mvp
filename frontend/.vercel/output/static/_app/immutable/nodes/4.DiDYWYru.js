import"../chunks/CWj6FrbW.js";import{o as Ae}from"../chunks/DN4i8kDz.js";import{a1 as we,a2 as Ke,W as _,ah as Pe,ag as ae,b as r,a5 as c,a6 as Ie,e as Ce,a7 as l,a8 as y,aa as De,a9 as s,g as t,ac as a,a3 as D,af as m,ai as Ee,a4 as Ne}from"../chunks/BkQX6IBl.js";import{i as P}from"../chunks/CmSFReHR.js";import{e as Le,i as Me}from"../chunks/DL943SAc.js";import{h as Se}from"../chunks/DN-AoazC.js";import{r as H}from"../chunks/TY_SEvFQ.js";import{s as Fe}from"../chunks/t6lN8a7b.js";import{b as J}from"../chunks/DE88cSuZ.js";import{g as Re}from"../chunks/DjFSqXvx.js";import{a as O}from"../chunks/D4n-kpo8.js";import{g as Te}from"../chunks/DQ6qqwK7.js";var Ye=y('<div class="error-banner svelte-l2iqfo"> </div>'),We=y('<div class="loading svelte-l2iqfo">Loading...</div>'),Ue=y(`<div class="empty-state svelte-l2iqfo"><p>You don't have any API keys yet.</p> <p>Create one to start using the API programmatically.</p></div>`),je=y('<span class="key-description svelte-l2iqfo"> </span>'),ze=y('<tr><td class="svelte-l2iqfo"><span class="key-name svelte-l2iqfo"> </span> <!></td><td class="svelte-l2iqfo"><code> </code></td><td class="svelte-l2iqfo"> </td><td class="svelte-l2iqfo"> </td><td class="svelte-l2iqfo"><span> </span></td><td class="svelte-l2iqfo"><button class="btn btn-danger btn-sm svelte-l2iqfo">Revoke</button></td></tr>'),Be=y('<table class="table svelte-l2iqfo"><thead><tr><th class="svelte-l2iqfo">Name</th><th class="svelte-l2iqfo">Key Prefix</th><th class="svelte-l2iqfo">Last Used</th><th class="svelte-l2iqfo">Expires</th><th class="svelte-l2iqfo">Status</th><th class="svelte-l2iqfo"></th></tr></thead><tbody></tbody></table>'),Ge=y('<div class="modal-overlay svelte-l2iqfo" role="dialog" aria-modal="true" aria-labelledby="create-modal-title" tabindex="-1"><div class="modal svelte-l2iqfo"><h2 id="create-modal-title" class="svelte-l2iqfo">Create New API Key</h2> <form><div class="form-group svelte-l2iqfo"><label for="name" class="svelte-l2iqfo">Name *</label> <input id="name" type="text" placeholder="e.g., Production Server" required class="svelte-l2iqfo"/></div> <div class="form-group svelte-l2iqfo"><label for="description" class="svelte-l2iqfo">Description</label> <input id="description" type="text" placeholder="What is this key for?" class="svelte-l2iqfo"/></div> <div class="form-group svelte-l2iqfo"><label for="expires" class="svelte-l2iqfo">Expires in (days)</label> <input id="expires" type="number" placeholder="Leave empty for no expiration" min="1" class="svelte-l2iqfo"/></div> <div class="modal-actions svelte-l2iqfo"><button type="button" class="btn btn-secondary svelte-l2iqfo">Cancel</button> <button type="submit" class="btn btn-primary svelte-l2iqfo"> </button></div></form></div></div>'),He=y(`<div class="modal-overlay svelte-l2iqfo" role="dialog" aria-modal="true" aria-labelledby="created-modal-title" tabindex="-1"><div class="modal svelte-l2iqfo"><h2 id="created-modal-title" class="svelte-l2iqfo">API Key Created</h2> <div class="warning-banner svelte-l2iqfo">Make sure to copy your API key now. You won't be able to see it again!</div> <div class="key-display svelte-l2iqfo"><code class="svelte-l2iqfo"> </code> <button class="btn btn-secondary btn-sm svelte-l2iqfo">Copy</button></div> <div class="modal-actions svelte-l2iqfo"><button class="btn btn-primary svelte-l2iqfo">Done</button></div></div></div>`),Je=y('<div class="container"><div class="page-header svelte-l2iqfo"><h1 class="svelte-l2iqfo">API Keys</h1> <p class="svelte-l2iqfo">Manage your API keys for programmatic access to the Community Resilience API.</p></div> <!> <div class="card svelte-l2iqfo"><div class="card-header svelte-l2iqfo"><h2 class="svelte-l2iqfo">Your API Keys</h2> <button class="btn btn-primary svelte-l2iqfo">Create New Key</button></div> <!></div></div> <!> <!>',1);function rt(se,le){Ke(le,!0);const ie=Te();let M=_(Pe([])),S=_(!0),h=_(null),x=_(!1),k=_(""),E=_(""),N=_(null),L=_(!1),A=_(null);Ae(async()=>{if(!ie.isAuthenticated){Re("/auth/login");return}await F()});async function F(){r(S,!0),r(h,null);try{const e=await O.auth.getApiKeys();r(M,e.api_keys,!0)}catch(e){r(h,e instanceof Error?e.message:"Failed to load API keys",!0)}r(S,!1)}async function re(){if(t(k).trim()){r(L,!0),r(h,null);try{const e=await O.auth.createApiKey({name:t(k).trim(),description:t(E).trim()||void 0,expires_in_days:t(N)||void 0});r(A,e,!0),await F(),r(k,""),r(E,""),r(N,null)}catch(e){r(h,e instanceof Error?e.message:"Failed to create API key",!0)}r(L,!1)}}async function oe(e){if(confirm("Are you sure you want to revoke this API key? This cannot be undone."))try{await O.auth.revokeApiKey(e),await F()}catch(i){r(h,i instanceof Error?i.message:"Failed to revoke API key",!0)}}function R(){r(A,null),r(x,!1)}function ve(e){navigator.clipboard.writeText(e)}var Q=Je();Se("l2iqfo",e=>{Ce(()=>{De.title="API Keys - Community Resilience"})});var T=ae(Q),V=l(s(T),2);{var ne=e=>{var i=Ye(),f=s(i,!0);a(i),D(()=>m(f,t(h))),c(e,i)};P(V,e=>{t(h)&&e(ne)})}var X=l(V,2),Y=s(X),de=l(s(Y),2);de.__click=()=>r(x,!0),a(Y);var ce=l(Y,2);{var fe=e=>{var i=We();c(e,i)},ue=e=>{var i=Ee(),f=ae(i);{var u=n=>{var d=Ue();c(n,d)},p=n=>{var d=Be(),b=l(s(d));Le(b,21,()=>t(M),Me,(q,o)=>{var w=ze(),K=s(w),g=s(K),W=s(g,!0);a(g);var v=l(g,2);{var ye=I=>{var C=je(),ke=s(C,!0);a(C),D(()=>m(ke,t(o).description)),c(I,C)};P(v,I=>{t(o).description&&I(ye)})}a(K);var U=l(K),$=s(U),be=s($);a($),a(U);var j=l(U),he=s(j,!0);a(j);var z=l(j),qe=s(z,!0);a(z);var B=l(z),G=s(B);let ee;var ge=s(G,!0);a(G),a(B);var te=l(B),xe=s(te);xe.__click=()=>oe(t(o).id),a(te),a(w),D((I,C)=>{m(W,t(o).name),m(be,`${t(o).key_prefix??""}...`),m(he,I),m(qe,C),ee=Fe(G,1,"status-badge svelte-l2iqfo",null,ee,{active:t(o).is_active}),m(ge,t(o).is_active?"Active":"Inactive")},[()=>t(o).last_used_at?new Date(t(o).last_used_at).toLocaleDateString():"Never",()=>t(o).expires_at?new Date(t(o).expires_at).toLocaleDateString():"Never"]),c(q,w)}),a(b),a(d),c(n,d)};P(f,n=>{t(M).length===0?n(u):n(p,!1)},!0)}c(e,i)};P(ce,e=>{t(S)?e(fe):e(ue,!1)})}a(X),a(T);var Z=l(T,2);{var pe=e=>{var i=Ge();i.__click=()=>r(x,!1),i.__keydown=v=>{v.key==="Escape"&&r(x,!1)};var f=s(i),u=l(s(f),2),p=s(u),n=l(s(p),2);H(n),a(p);var d=l(p,2),b=l(s(d),2);H(b),a(d);var q=l(d,2),o=l(s(q),2);H(o),a(q);var w=l(q,2),K=s(w);K.__click=()=>r(x,!1);var g=l(K,2),W=s(g,!0);a(g),a(w),a(u),a(f),a(i),D(v=>{g.disabled=v,m(W,t(L)?"Creating...":"Create Key")},[()=>t(L)||!t(k).trim()]),Ne("submit",u,v=>{v.preventDefault(),re()}),J(n,()=>t(k),v=>r(k,v)),J(b,()=>t(E),v=>r(E,v)),J(o,()=>t(N),v=>r(N,v)),c(e,i)};P(Z,e=>{t(x)&&!t(A)&&e(pe)})}var _e=l(Z,2);{var me=e=>{var i=He();i.__click=R,i.__keydown=o=>{o.key==="Escape"&&R()};var f=s(i),u=l(s(f),4),p=s(u),n=s(p,!0);a(p);var d=l(p,2);d.__click=()=>ve(t(A).key),a(u);var b=l(u,2),q=s(b);q.__click=R,a(b),a(f),a(i),D(()=>m(n,t(A).key)),c(e,i)};P(_e,e=>{t(A)&&e(me)})}c(se,Q),Ie()}we(["click","keydown"]);export{rt as component};
