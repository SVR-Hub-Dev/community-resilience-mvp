import{c as l}from"./DQ6qqwK7.js";const c="/api";let h=!1,g=null;async function f(){return!1}async function i(e,t,r=!1){const n={"Content-Type":"application/json",...t==null?void 0:t.headers};let s=await fetch(`${c}${e}`,{...t,headers:n,credentials:"include"});if(s.status===401&&!r){h||(h=!0,g=f());const o=await g;if(h=!1,g=null,o)s=await fetch(`${c}${e}`,{...t,headers:n});else throw l(),typeof window<"u"&&(window.location.href="/auth/login"),new Error("Session expired. Please log in again.")}if(!s.ok){const o=await s.json().catch(()=>({detail:"Request failed"}));throw new Error(o.detail||`HTTP ${s.status}`)}const u=await s.text();return u?JSON.parse(u):{}}async function d(e,t){return i(e,t,!0)}async function a(e,t){const r={},n=await fetch(`${c}${e}`,{method:"POST",headers:r,body:t,credentials:"include"});if(!n.ok){const s=await n.json().catch(()=>({detail:"Upload failed"}));throw new Error(s.detail||`HTTP ${n.status}`)}return n.json()}const S={query:e=>i("/query",{method:"POST",body:JSON.stringify({text:e})}),getKnowledge:()=>i("/knowledge"),getKnowledgeById:e=>i(`/knowledge/${e}`),createKnowledge:e=>i("/ingest",{method:"POST",body:JSON.stringify(e)}),updateKnowledge:(e,t)=>i(`/knowledge/${e}`,{method:"PUT",body:JSON.stringify(t)}),deleteKnowledge:e=>i(`/knowledge/${e}`,{method:"DELETE"}),submitFeedback:e=>i("/feedback",{method:"POST",body:JSON.stringify(e)}),getEvents:()=>i("/events"),createEvent:e=>i("/events",{method:"POST",body:JSON.stringify(e)}),getAssets:()=>i("/assets"),createAsset:e=>i("/assets",{method:"POST",body:JSON.stringify(e)}),documents:{upload:(e,t)=>{const r=new FormData;return r.append("file",e),t!=null&&t.title&&r.append("title",t.title),t!=null&&t.description&&r.append("description",t.description),t!=null&&t.tags&&r.append("tags",t.tags),t!=null&&t.location&&r.append("location",t.location),t!=null&&t.hazard_type&&r.append("hazard_type",t.hazard_type),t!=null&&t.source&&r.append("source",t.source),a("/documents/upload",r)},getStatus:e=>i(`/documents/${e}/status`),getProcessingStats:()=>i("/documents/processing/stats")},knowledgeGraph:{getEntities:e=>{const t=new URLSearchParams;e!=null&&e.entity_type&&t.set("entity_type",e.entity_type),e!=null&&e.search&&t.set("search",e.search),e!=null&&e.limit&&t.set("limit",e.limit.toString()),e!=null&&e.offset&&t.set("offset",e.offset.toString());const r=t.toString();return i(`/kg/entities${r?`?${r}`:""}`)},getEntity:e=>i(`/kg/entities/${e}`),searchEntities:(e,t)=>{const r=new URLSearchParams({q:e});return t==null||t.forEach(n=>r.append("entity_types",n)),i(`/kg/entities/search?${r}`)},getStatistics:()=>i("/kg/statistics"),getCoverageGaps:(e,t,r)=>i(`/kg/coverage-gaps?entity_type=${e}&required_relationship=${t}&target_type=${r}`),getEntityNetwork:(e,t)=>i(`/kg/entities/${e}/network${t?`?max_depth=${t}`:""}`),createEntity:e=>i("/kg/entities",{method:"POST",body:JSON.stringify(e)}),updateEntity:(e,t)=>i(`/kg/entities/${e}`,{method:"PUT",body:JSON.stringify(t)}),deleteEntity:e=>i(`/kg/entities/${e}`,{method:"DELETE"}),getTypes:()=>i("/kg/types")},getHealth:()=>d("/health"),auth:{register:e=>d("/auth/register",{method:"POST",body:JSON.stringify(e)}),login:e=>d("/auth/login",{method:"POST",body:JSON.stringify(e)}),loginTotp:e=>d("/auth/login/totp",{method:"POST",body:JSON.stringify(e)}),setupTotp:()=>i("/auth/totp/setup",{method:"POST"}),verifyTotpSetup:e=>i("/auth/totp/verify-setup",{method:"POST",body:JSON.stringify({code:e})}),setPassword:e=>i("/auth/password",{method:"PUT",body:JSON.stringify(e)}),disableTotp:()=>i("/auth/totp",{method:"DELETE"}),getLoginUrl:e=>d(`/auth/login/${e}`),refresh:e=>d("/auth/refresh",{method:"POST",body:JSON.stringify({refresh_token:e})}),logout:e=>i("/auth/logout",{method:"POST",body:JSON.stringify({refresh_token:e})}),logoutAll:()=>i("/auth/logout-all",{method:"POST"}),getMe:()=>i("/auth/me"),updateMe:e=>i("/auth/me",{method:"PUT",body:JSON.stringify(e)}),getSessions:()=>i("/auth/me/sessions"),getApiKeys:()=>i("/auth/api-keys"),createApiKey:e=>i("/auth/api-keys",{method:"POST",body:JSON.stringify(e)}),revokeApiKey:e=>i(`/auth/api-keys/${e}`,{method:"DELETE"}),admin:{getUsers:e=>{const t=new URLSearchParams;e!=null&&e.skip&&t.set("skip",e.skip.toString()),e!=null&&e.limit&&t.set("limit",e.limit.toString()),(e==null?void 0:e.is_active)!==void 0&&t.set("is_active",e.is_active.toString()),e!=null&&e.role&&t.set("role",e.role);const r=t.toString();return i(`/auth/users${r?`?${r}`:""}`)},getUser:e=>i(`/auth/users/${e}`),updateUser:(e,t)=>i(`/auth/users/${e}`,{method:"PUT",body:JSON.stringify(t)}),deleteUser:e=>i(`/auth/users/${e}`,{method:"DELETE"})}}};export{S as a};
