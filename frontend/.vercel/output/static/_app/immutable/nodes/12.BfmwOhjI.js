import"../chunks/CWj6FrbW.js";import{o as Be}from"../chunks/DN4i8kDz.js";import{a2 as le,ai as de,ag as R,a5 as d,a6 as oe,a9 as t,ac as a,a3 as f,af as i,a7 as n,g as e,a8 as p,a1 as Qe,W as B,ah as Ve,b as J,aJ as Xe,aa as Ye,aj as q,aD as Ze}from"../chunks/BkQX6IBl.js";import{i as g}from"../chunks/CmSFReHR.js";import{e as ce,i as pe}from"../chunks/DL943SAc.js";import{h as ea}from"../chunks/DN-AoazC.js";import{s as Q}from"../chunks/8ubIwWSs.js";import{s as aa,a as ta}from"../chunks/H8I9kM3U.js";import{p as ra}from"../chunks/Dv07f5jY.js";import{a as sa}from"../chunks/D4n-kpo8.js";import{s as ke}from"../chunks/TY_SEvFQ.js";import{s as na}from"../chunks/t6lN8a7b.js";var va=p('<p class="empty svelte-1r2hed0"> </p>'),ia=p('<span class="rel-source svelte-1r2hed0"> </span> <span class="rel-type svelte-1r2hed0"> </span> <span class="arrow svelte-1r2hed0">&rarr;</span> <a class="rel-target svelte-1r2hed0"> </a> <span class="rel-entity-type svelte-1r2hed0"> </span>',1),la=p('<a class="rel-source svelte-1r2hed0"> </a> <span class="rel-entity-type svelte-1r2hed0"> </span> <span class="rel-type svelte-1r2hed0"> </span> <span class="arrow svelte-1r2hed0">&rarr;</span> <span class="rel-target svelte-1r2hed0"> </span>',1),da=p('<li class="rel-item svelte-1r2hed0"><div class="rel-arrow svelte-1r2hed0"><!></div> <div class="rel-confidence svelte-1r2hed0"><div class="confidence-bar svelte-1r2hed0"><div class="confidence-fill svelte-1r2hed0"></div></div> <span class="confidence-value svelte-1r2hed0"> </span></div></li>'),oa=p('<ul class="rel-list svelte-1r2hed0"></ul>');function ze(F,x){le(x,!0);var S=de(),H=R(S);{var j=$=>{var m=va(),h=t(m);a(m),f(()=>i(h,`No ${x.direction??""} relationships.`)),d($,m)},s=$=>{var m=oa();ce(m,21,()=>x.relationships,pe,(h,l)=>{var M=da(),y=t(M),D=t(y);{var E=_=>{var r=ia(),v=R(r),k=t(v,!0);a(v);var z=n(v,2),L=t(z,!0);a(z);var b=n(z,4),G=t(b,!0);a(b);var u=n(b,2),N=t(u);a(u),f(()=>{i(k,x.entityName),i(L,e(l).relationship_type),ke(b,"href",`/knowledge-graph/${e(l).entity_id??""}`),i(G,e(l).entity_name),i(N,`(${e(l).entity_type??""})`)}),d(_,r)},C=_=>{var r=la(),v=R(r),k=t(v,!0);a(v);var z=n(v,2),L=t(z);a(z);var b=n(z,2),G=t(b,!0);a(b);var u=n(b,4),N=t(u,!0);a(u),f(()=>{ke(v,"href",`/knowledge-graph/${e(l).entity_id??""}`),i(k,e(l).entity_name),i(L,`(${e(l).entity_type??""})`),i(G,e(l).relationship_type),i(N,x.entityName)}),d(_,r)};g(D,_=>{x.direction==="outgoing"?_(E):_(C,!1)})}a(y);var A=n(y,2),I=t(A),P=t(I);a(I);var O=n(I,2),T=t(O);a(O),a(A),a(M),f((_,r)=>{Q(P,`width: ${_??""}%`),i(T,`${r??""}%`)},[()=>Math.round(e(l).confidence_score*100),()=>Math.round(e(l).confidence_score*100)]),d(h,M)}),a(m),d($,m)};g(H,$=>{x.relationships.length===0?$(j):$(s,!1)})}d(F,S),oe()}var ca=p('<p class="empty svelte-14bzost">No evidence records.</p>'),pa=p('<span class="confidence svelte-14bzost"> </span>'),_a=p('<button class="expand-btn svelte-14bzost"> </button>'),fa=p('<div><p class="svelte-14bzost"> </p></div> <!>',1),ha=p('<li class="evidence-item svelte-14bzost"><div class="evidence-header svelte-14bzost"><a href="/documents" class="doc-link svelte-14bzost"> </a> <!></div> <!></li>'),ya=p('<ul class="evidence-list svelte-14bzost"></ul>');function ua(F,x){le(x,!0);let S=B(Ve(new Set));function H(h){const l=new Set(e(S));l.has(h)?l.delete(h):l.add(h),J(S,l,!0)}var j=de(),s=R(j);{var $=h=>{var l=ca();d(h,l)},m=h=>{var l=ya();ce(l,21,()=>x.evidence,pe,(M,y)=>{var D=ha(),E=t(D),C=t(E),A=t(C);a(C);var I=n(C,2);{var P=_=>{var r=pa(),v=t(r);a(r),f(k=>i(v,`${k??""}% confidence`),[()=>Math.round(e(y).extraction_confidence*100)]),d(_,r)};g(I,_=>{e(y).extraction_confidence!=null&&_(P)})}a(E);var O=n(E,2);{var T=_=>{var r=fa(),v=R(r);let k;var z=t(v),L=t(z,!0);a(z),a(v);var b=n(v,2);{var G=u=>{var N=_a();N.__click=()=>H(e(y).id);var V=t(N,!0);a(N),f(U=>i(V,U),[()=>e(S).has(e(y).id)?"Show less":"Show more"]),d(u,N)};g(b,u=>{e(y).evidence_text.length>200&&u(G)})}f(u=>{k=na(v,1,"evidence-text svelte-14bzost",null,k,u),i(L,e(y).evidence_text)},[()=>({expanded:e(S).has(e(y).id)})]),d(_,r)};g(O,_=>{e(y).evidence_text&&_(T)})}a(D),f(()=>i(A,`Document #${e(y).document_id??""}`)),d(M,D)}),a(l),d(h,l)};g(s,h=>{x.evidence.length===0?h($):h(m,!1)})}d(F,j),oe()}Qe(["click"]);var ga=p('<div class="alert alert-error"> </div>'),ma=p('<div class="loading"><div class="spinner"></div></div>'),xa=p('<span class="subtype-badge svelte-1ntfpny"> </span>'),ba=p('<span class="method-badge svelte-1ntfpny"> </span>'),wa=p('<div class="card info-card svelte-1ntfpny"><h2 class="svelte-1ntfpny">Location</h2> <p class="svelte-1ntfpny"> </p></div>'),$a=p('<div class="attr-row svelte-1ntfpny"><dt class="svelte-1ntfpny"> </dt> <dd class="svelte-1ntfpny"> </dd></div>'),ka=p('<div class="card info-card svelte-1ntfpny"><h2 class="svelte-1ntfpny">Attributes</h2> <dl class="attrs-list svelte-1ntfpny"></dl></div>'),za=p("<span> </span>"),Na=p("<span> </span>"),Sa=p('<div class="entity-header svelte-1ntfpny"><div class="header-main svelte-1ntfpny"><h1 class="svelte-1ntfpny"> </h1> <div class="header-badges svelte-1ntfpny"><span class="type-badge svelte-1ntfpny"> </span> <!> <!></div></div> <div class="header-confidence svelte-1ntfpny"><span class="confidence-label svelte-1ntfpny">Confidence</span> <div class="confidence-bar-large svelte-1ntfpny"><div class="confidence-fill-large svelte-1ntfpny"></div></div> <span class="confidence-value svelte-1ntfpny"> </span></div></div> <div class="detail-grid svelte-1ntfpny"><div class="detail-section svelte-1ntfpny"><!> <!> <div class="card info-card svelte-1ntfpny"><h2 class="svelte-1ntfpny"> </h2> <!></div></div> <div class="detail-section svelte-1ntfpny"><div class="card info-card svelte-1ntfpny"><h2 class="svelte-1ntfpny"> </h2> <!></div> <div class="card info-card svelte-1ntfpny"><h2 class="svelte-1ntfpny"> </h2> <!></div></div></div> <div class="meta-footer svelte-1ntfpny"><!> <!></div>',1),Da=p('<div class="container"><nav class="breadcrumb svelte-1ntfpny"><a href="/knowledge-graph" class="svelte-1ntfpny">Knowledge Graph</a> <span class="sep svelte-1ntfpny">/</span> <span> </span></nav> <!> <!></div>');function Fa(F,x){le(x,!0);const S=()=>ta(ra,"$page",H),[H,j]=aa();let s=B(null),$=B(!0),m=B("");const h={HazardType:"#dc2626",Community:"#2563eb",Agency:"#7c3aed",Location:"#059669",Resource:"#d97706",Action:"#0891b2"};let l=q(()=>e(s)&&h[e(s).entity_type]||"#6b7280"),M=q(()=>e(s)?Math.round(e(s).confidence_score*100):0);Be(async()=>{const r=Number(S().params.id);if(isNaN(r)){J(m,"Invalid entity ID"),J($,!1);return}try{J(s,await sa.knowledgeGraph.getEntity(r),!0)}catch(v){J(m,v instanceof Error?v.message:"Failed to load entity",!0)}finally{J($,!1)}});let y=q(()=>{var r;return(r=e(s))!=null&&r.attributes?Object.entries(e(s).attributes).filter(([,v])=>v!=null):[]});var D=Da();ea("1ntfpny",r=>{Xe(()=>{var v;Ye.title=`${(((v=e(s))==null?void 0:v.name)||"Entity")??""} - Knowledge Graph`})});var E=t(D),C=n(t(E),4),A=t(C,!0);a(C),a(E);var I=n(E,2);{var P=r=>{var v=ga(),k=t(v,!0);a(v),f(()=>i(k,e(m))),d(r,v)};g(I,r=>{e(m)&&r(P)})}var O=n(I,2);{var T=r=>{var v=ma();d(r,v)},_=r=>{var v=de(),k=R(v);{var z=L=>{var b=Sa(),G=R(b),u=t(G),N=t(u),V=t(N,!0);a(N);var U=n(N,2),W=t(U),Ne=t(W,!0);a(W);var _e=n(W,2);{var Se=o=>{var c=xa(),w=t(c,!0);a(c),f(()=>i(w,e(s).entity_subtype)),d(o,c)};g(_e,o=>{e(s).entity_subtype&&o(Se)})}var De=n(_e,2);{var Ee=o=>{var c=ba(),w=t(c,!0);a(c),f(()=>i(w,e(s).extraction_method)),d(o,c)};g(De,o=>{e(s).extraction_method&&o(Ee)})}a(U),a(u);var fe=n(u,2),X=n(t(fe),2),Le=t(X);a(X);var Y=n(X,2),Ge=t(Y);a(Y),a(fe),a(G);var Z=n(G,2),ee=t(Z),he=t(ee);{var Me=o=>{var c=wa(),w=n(t(c),2),K=t(w,!0);a(w),a(c),f(()=>i(K,e(s).location_text)),d(o,c)};g(he,o=>{e(s).location_text&&o(Me)})}var ye=n(he,2);{var Ce=o=>{var c=ka(),w=n(t(c),2);ce(w,21,()=>e(y),pe,(K,Pe)=>{var we=q(()=>Ze(e(Pe),2));let Te=()=>e(we)[0],ne=()=>e(we)[1];var ve=$a(),ie=t(ve),Ue=t(ie,!0);a(ie);var $e=n(ie,2),We=t($e,!0);a($e),a(ve),f(qe=>{i(Ue,Te()),i(We,qe)},[()=>typeof ne()=="object"?JSON.stringify(ne()):String(ne())]),d(K,ve)}),a(w),a(c),d(o,c)};g(ye,o=>{e(y).length>0&&o(Ce)})}var ue=n(ye,2),ae=t(ue),Ie=t(ae);a(ae);var Ke=n(ae,2);ua(Ke,{get evidence(){return e(s).evidence}}),a(ue),a(ee);var ge=n(ee,2),te=t(ge),re=t(te),Re=t(re);a(re);var je=n(re,2);ze(je,{get relationships(){return e(s).outgoing_relationships},direction:"outgoing",get entityName(){return e(s).name}}),a(te);var me=n(te,2),se=t(me),Ae=t(se);a(se);var Oe=n(se,2);ze(Oe,{get relationships(){return e(s).incoming_relationships},direction:"incoming",get entityName(){return e(s).name}}),a(me),a(ge),a(Z);var xe=n(Z,2),be=t(xe);{var Je=o=>{var c=za(),w=t(c);a(c),f(K=>i(w,`Created: ${K??""}`),[()=>new Date(e(s).created_at).toLocaleDateString()]),d(o,c)};g(be,o=>{e(s).created_at&&o(Je)})}var Fe=n(be,2);{var He=o=>{var c=Na(),w=t(c);a(c),f(K=>i(w,`Updated: ${K??""}`),[()=>new Date(e(s).updated_at).toLocaleDateString()]),d(o,c)};g(Fe,o=>{e(s).updated_at&&o(He)})}a(xe),f(()=>{i(V,e(s).name),Q(W,`color: ${e(l)??""}; border-color: ${e(l)??""}`),i(Ne,e(s).entity_type),Q(Le,`width: ${e(M)??""}%; background: ${e(l)??""}`),Q(Y,`color: ${e(l)??""}`),i(Ge,`${e(M)??""}%`),i(Ie,`Evidence (${e(s).evidence.length??""})`),i(Re,`Outgoing Relationships (${e(s).outgoing_relationships.length??""})`),i(Ae,`Incoming Relationships (${e(s).incoming_relationships.length??""})`)}),d(L,b)};g(k,L=>{e(s)&&L(z)},!0)}d(r,v)};g(O,r=>{e($)?r(T):r(_,!1)})}a(D),f(()=>{var r;return i(A,((r=e(s))==null?void 0:r.name)||"Loading...")}),d(F,D),oe(),j()}export{Fa as component};
