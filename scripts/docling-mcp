#!/usr/bin/env bash
set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
LOG_DIR="$PROJECT_ROOT/.mcp-logs"
mkdir -p "$LOG_DIR"

LOG_FILE="$LOG_DIR/docling-mcp-$(date +%Y%m%d-%H%M%S).log"

echo "[INFO] Starting Docling MCP server" | tee -a "$LOG_FILE"

if [ -f "$PROJECT_ROOT/backend/venv/bin/docling-mcp" ]; then
  exec "$PROJECT_ROOT/backend/venv/bin/docling-mcp" "$@" 2>&1 | tee -a "$LOG_FILE"
fi

if command -v docling-mcp >/dev/null 2>&1; then
  exec docling-mcp "$@" 2>&1 | tee -a "$LOG_FILE"
fi

echo "[ERROR] docling-mcp not found" | tee -a "$LOG_FILE"
exit 1
