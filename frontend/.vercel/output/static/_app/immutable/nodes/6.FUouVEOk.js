import{a as i,f as v,c as b,s as E}from"../chunks/DrEVJf_X.js";import{o as U}from"../chunks/CY6dNTIf.js";import{a0 as W,a2 as Y,e as j,b as r,a5 as q,a4 as g,g as f,a7 as m,a8 as M,a9 as d,aa as _,a3 as D,a1 as G}from"../chunks/BIQOLOFU.js";import{i as k}from"../chunks/NPzolRrf.js";import{h as H}from"../chunks/82X_sTQh.js";import{s as J,a as K}from"../chunks/jma30hyI.js";import{g as N}from"../chunks/D1v8bg46.js";import{p as O}from"../chunks/BON2bsc1.js";import{s as T,a as Q}from"../chunks/D6zz_Kj-.js";var V=v('<div class="status-icon loading svelte-3cfahf"><span class="spinner svelte-3cfahf"></span></div> <h1 class="svelte-3cfahf">Signing you in...</h1> <p class="svelte-3cfahf">Please wait while we complete your authentication.</p>',1),X=v(`<div class="status-icon success svelte-3cfahf"><svg viewBox="0 0 24 24" width="48" height="48"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg></div> <h1 class="svelte-3cfahf">Welcome!</h1> <p class="svelte-3cfahf">You've been signed in successfully. Redirecting...</p>`,1),Z=v('<div class="status-icon error svelte-3cfahf"><svg viewBox="0 0 24 24" width="48" height="48"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></div> <h1 class="svelte-3cfahf">Authentication Failed</h1> <p class="svelte-3cfahf"> </p> <a href="/auth/login" class="retry-button svelte-3cfahf">Try Again</a>',1),ee=v('<div class="callback-container svelte-3cfahf"><div class="callback-card svelte-3cfahf"><!></div></div>');function fe($,C){W(C,!0);const I=()=>K(O,"$page",A),[A,L]=J();let s=M("loading"),n=M(null);U(async()=>{const e=I().url.searchParams,t=e.get("access_token"),c=e.get("refresh_token"),p=e.get("expires_in"),l=e.get("error");if(l){r(s,"error"),r(n,decodeURIComponent(l),!0);return}if(!t||!c){r(s,"error"),r(n,"Missing authentication tokens");return}try{const a={access_token:t,refresh_token:c,token_type:"bearer",expires_in:parseInt(p||"1800")};T({id:0,email:"",name:"",role:"viewer",oauth_provider:null,avatar_url:null,is_active:!0,created_at:"",updated_at:""},a);const o=await Q.auth.getMe();T(o,a),r(s,"success"),setTimeout(()=>{N("/")},1500)}catch(a){r(s,"error"),r(n,a instanceof Error?a.message:"Failed to complete authentication",!0)}});var h=ee();H("3cfahf",e=>{j(()=>{q.title="Signing In... - Community Resilience"})});var w=g(h),R=g(w);{var S=e=>{var t=V();d(4),i(e,t)},z=e=>{var t=b(),c=_(t);{var p=a=>{var o=X();d(4),i(a,o)},l=a=>{var o=b(),B=_(o);{var F=u=>{var x=Z(),y=D(_(x),4),P=g(y,!0);m(y),d(2),G(()=>E(P,f(n)||"Something went wrong during sign in.")),i(u,x)};k(B,u=>{f(s)==="error"&&u(F)},!0)}i(a,o)};k(c,a=>{f(s)==="success"?a(p):a(l,!1)},!0)}i(e,t)};k(R,e=>{f(s)==="loading"?e(S):e(z,!1)})}m(w),m(h),i($,h),Y(),L()}export{fe as component};
