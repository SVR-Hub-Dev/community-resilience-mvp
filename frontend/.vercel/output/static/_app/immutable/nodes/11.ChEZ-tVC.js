import"../chunks/CWj6FrbW.js";import{a2 as yt,a9 as s,ac as e,a7 as r,a3 as p,g as t,af as l,a5 as c,a6 as ut,aj as q,a8 as y,a1 as Tt,W as k,ah as Ct,ak as Et,b as _,e as St,aa as Rt,ad as at,ag as vt,ai as Gt,aD as Lt}from"../chunks/BkQX6IBl.js";import{i as A}from"../chunks/CmSFReHR.js";import{e as st,i as dt}from"../chunks/DL943SAc.js";import{h as zt}from"../chunks/DN-AoazC.js";import{s as Ht,r as It,a as Kt}from"../chunks/TY_SEvFQ.js";import{s as ot}from"../chunks/t6lN8a7b.js";import{g as jt}from"../chunks/DjFSqXvx.js";import{a as ct}from"../chunks/D4n-kpo8.js";import{g as Dt}from"../chunks/DQ6qqwK7.js";import{s as nt}from"../chunks/8ubIwWSs.js";var Ft=y('<span class="subtype svelte-1ba0tyl"> </span>'),Mt=y('<p class="entity-location svelte-1ba0tyl"> </p>'),Nt=y('<span class="method-badge svelte-1ba0tyl"> </span>'),Pt=y('<a class="entity-card svelte-1ba0tyl"><div class="entity-header svelte-1ba0tyl"><span class="type-icon svelte-1ba0tyl"> </span> <div class="entity-info svelte-1ba0tyl"><h3 class="entity-name svelte-1ba0tyl"> </h3> <div class="entity-type-row svelte-1ba0tyl"><span class="type-badge svelte-1ba0tyl"> </span> <!></div></div></div> <!> <div class="entity-footer svelte-1ba0tyl"><div class="confidence svelte-1ba0tyl"><div class="confidence-bar svelte-1ba0tyl"><div class="confidence-fill svelte-1ba0tyl"></div></div> <span class="confidence-label svelte-1ba0tyl"> </span></div> <!></div></a>');function Yt(B,v){yt(v,!0);const J={HazardType:"#dc2626",Community:"#2563eb",Agency:"#7c3aed",Location:"#059669",Resource:"#d97706",Action:"#0891b2"},P={HazardType:"H",Community:"C",Agency:"A",Location:"L",Resource:"R",Action:"X"};let m=q(()=>J[v.entity.entity_type]||"#6b7280"),h=q(()=>P[v.entity.entity_type]||"?"),L=q(()=>Math.round(v.entity.confidence_score*100));var b=Pt(),x=s(b),T=s(x),g=s(T,!0);e(T);var z=r(T,2),C=s(z),H=s(C,!0);e(C);var Y=r(C,2),E=s(Y),V=s(E,!0);e(E);var I=r(E,2);{var O=d=>{var o=Ft(),G=s(o,!0);e(o),p(()=>l(G,v.entity.entity_subtype)),c(d,o)};A(I,d=>{v.entity.entity_subtype&&d(O)})}e(Y),e(z),e(x);var Q=r(x,2);{var U=d=>{var o=Mt(),G=s(o,!0);e(o),p(()=>l(G,v.entity.location_text)),c(d,o)};A(Q,d=>{v.entity.location_text&&d(U)})}var W=r(Q,2),S=s(W),R=s(S),K=s(R);e(R);var j=r(R,2),Z=s(j);e(j),e(S);var X=r(S,2);{var D=d=>{var o=Nt(),G=s(o,!0);e(o),p(()=>l(G,v.entity.extraction_method)),c(d,o)};A(X,d=>{v.entity.extraction_method&&d(D)})}e(W),e(b),p(()=>{Ht(b,"href",`/knowledge-graph/${v.entity.id??""}`),nt(T,`background: ${t(m)??""}`),l(g,t(h)),l(H,v.entity.name),nt(E,`color: ${t(m)??""}; border-color: ${t(m)??""}`),l(V,v.entity.entity_type),nt(K,`width: ${t(L)??""}%; background: ${t(m)??""}`),l(Z,`${t(L)??""}%`)}),c(B,b),ut()}var Ot=y('<div class="alert alert-error"> </div>'),Qt=y('<div class="stat-card stat-card-small svelte-n1dg1y"><span class="stat-value svelte-n1dg1y"> </span> <span class="stat-label svelte-n1dg1y"> </span></div>'),Ut=y('<div class="stats-row svelte-n1dg1y"><div class="stat-card svelte-n1dg1y"><span class="stat-value svelte-n1dg1y"> </span> <span class="stat-label svelte-n1dg1y">Entities</span></div> <div class="stat-card svelte-n1dg1y"><span class="stat-value svelte-n1dg1y"> </span> <span class="stat-label svelte-n1dg1y">Relationships</span></div> <div class="stat-card svelte-n1dg1y"><span class="stat-value svelte-n1dg1y"> </span> <span class="stat-label svelte-n1dg1y">Avg Confidence</span></div> <!></div>'),Wt=y("<button> </button>"),Xt=y("&middot; filtered by <strong> </strong>",1),qt=y('<div class="loading"><div class="spinner"></div></div>'),Bt=y('<div class="card empty-state svelte-n1dg1y"><p>No knowledge graph entities found. Upload documents to start extracting structured knowledge.</p></div>'),Jt=y('<div class="entities-grid svelte-n1dg1y"></div>'),Vt=y('<div class="container"><div class="page-header svelte-n1dg1y"><div class="header-row svelte-n1dg1y"><h1 class="svelte-n1dg1y">Knowledge Graph</h1></div> <p class="svelte-n1dg1y">Structured entities and relationships extracted from community documents.</p></div> <!> <!> <div class="filters-bar svelte-n1dg1y"><div class="type-filters svelte-n1dg1y"><button>All</button> <!></div> <div class="search-box svelte-n1dg1y"><input type="text" class="input search-input svelte-n1dg1y" placeholder="Search entities..."/></div></div> <p class="results-count svelte-n1dg1y"> <!></p> <!></div>');function de(B,v){yt(v,!0);const J=["HazardType","Community","Agency","Location","Resource","Action"],P=Dt();let m=k(Ct([])),h=k(null),L=k(0),b=k(!0),x=k(""),T=k(!1),g=k(""),z=k(""),C=null;Et(()=>{if(P.isInitialized&&!t(T)){if(!P.isAuthenticated){jt("/auth/login");return}_(T,!0),H(),Y()}});async function H(){_(b,!0),_(x,"");try{const a=await ct.knowledgeGraph.getEntities({entity_type:t(g)||void 0,search:t(z)||void 0,limit:100});_(m,a.entities,!0),_(L,a.total,!0)}catch(a){_(x,a instanceof Error?a.message:"Failed to load entities",!0)}finally{_(b,!1)}}async function Y(){try{_(h,await ct.knowledgeGraph.getStatistics(),!0)}catch{}}function E(a){_(g,a===t(g)?"":a,!0),H()}function V(a){const n=a.target;_(z,n.value,!0),C&&clearTimeout(C),C=setTimeout(()=>{H()},300)}var I=Vt();zt("n1dg1y",a=>{St(()=>{Rt.title="Knowledge Graph - Community Resilience"})});var O=r(s(I),2);{var Q=a=>{var n=Ot(),i=s(n,!0);e(n),p(()=>l(i,t(x))),c(a,n)};A(O,a=>{t(x)&&a(Q)})}var U=r(O,2);{var W=a=>{var n=Ut(),i=s(n),f=s(i),F=s(f,!0);e(f),at(2),e(i);var u=r(i,2),w=s(u),M=s(w,!0);e(w),at(2),e(u);var N=r(u,2),rt=s(N),mt=s(rt);e(rt),at(2),e(N);var ht=r(N,2);st(ht,17,()=>Object.entries(t(h).entity_counts),dt,($,bt)=>{var it=q(()=>Lt(t(bt),2));let xt=()=>t(it)[0],wt=()=>t(it)[1];var tt=Qt(),et=s(tt),kt=s(et,!0);e(et);var lt=r(et,2),At=s(lt,!0);e(lt),e(tt),p(()=>{l(kt,wt()),l(At,xt())}),c($,tt)}),e(n),p($=>{l(F,t(h).total_entities),l(M,t(h).total_relationships),l(mt,`${$??""}%`)},[()=>Math.round(t(h).avg_confidence*100)]),c(a,n)};A(U,a=>{t(h)&&a(W)})}var S=r(U,2),R=s(S),K=s(R);let j;K.__click=()=>E("");var Z=r(K,2);st(Z,17,()=>J,dt,(a,n)=>{var i=Wt();let f;i.__click=()=>E(t(n));var F=s(i,!0);e(i),p(()=>{f=ot(i,1,"filter-btn svelte-n1dg1y",null,f,{active:t(g)===t(n)}),l(F,t(n))}),c(a,i)}),e(R);var X=r(R,2),D=s(X);It(D),D.__input=V,e(X),e(S);var d=r(S,2),o=s(d),G=r(o);{var _t=a=>{var n=Xt(),i=r(vt(n)),f=s(i,!0);e(i),p(()=>l(f,t(g))),c(a,n)};A(G,a=>{t(g)&&a(_t)})}e(d);var pt=r(d,2);{var gt=a=>{var n=qt();c(a,n)},ft=a=>{var n=Gt(),i=vt(n);{var f=u=>{var w=Bt();c(u,w)},F=u=>{var w=Jt();st(w,21,()=>t(m),M=>M.id,(M,N)=>{Yt(M,{get entity(){return t(N)}})}),e(w),c(u,w)};A(i,u=>{t(m).length===0?u(f):u(F,!1)},!0)}c(a,n)};A(pt,a=>{t(b)?a(gt):a(ft,!1)})}e(I),p(()=>{j=ot(K,1,"filter-btn svelte-n1dg1y",null,j,{active:t(g)===""}),Kt(D,t(z)),l(o,`${t(L)??""} ${t(L)===1?"entity":"entities"} found `)}),c(B,I),ut()}Tt(["click","input"]);export{de as component};
